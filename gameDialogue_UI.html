<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      /* Add any custom styles for your dialog here */
      .selected-game-type {
        display: inline-block;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
      }

      .game-type-options {
        display: none;
        position: absolute;
        z-index: 1;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        cursor: default;
        padding: 5px;
        max-height: 300px;
        overflow-y: auto;
      }

      .game-type-option {
        margin: 5px 0;
        cursor: pointer;
      }

      .game-type-option:hover {
        background-color: #eee;
      }

      .game-type-tooltip {
        position: absolute;
        z-index: 2;
        display: none;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        padding: 5px;
        max-width: 300px;
        text-align: left;
      }
      .game-type-option:hover + .game-type-tooltip,
      .selected-game-type:hover + .game-type-tooltip {
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>Text RPG</h1>
    <div id="gameOptions">
      <h2>Game Type</h2>
      <div class="selected-game-type" onclick="toggleGameTypeOptions()" id="currentGameTypeBtn">
        <!-- Display the selected game type here -->
        <div id="selectedGameType"></div>
      </div>
      <div class="game-type-options" onmouseleave="hideGameTypeOptions()" id="gameOptionsContainer">
        <!-- Display the game type options here -->
        <div id="gameTypeOptions"></div>
      </div>
    </div>
    <button id="newGameBtn">New Game</button>
    <button id="loadGameBtn">Load Game</button>
    <button id="splitTimelineBtn">Split Timeline</button>

    <div id="gameWindow">
      <h2>Game State</h2>
      <div id="gameStateDisplay"></div>
      <h2>Scene</h2>
      <div id="sceneDisplay"></div>
      <h2>Image</h2>
      <div id="imageDisplay"></div>
      <h2>Response</h2>
      <textarea id="responseInput"></textarea>
      <button id="submitResponseBtn">Submit</button>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        loadLastGame();
        // Call displayGameState when the dialog is loaded
        google.script.run.withSuccessHandler(displayGameState).getGameState();
      });

      function loadLastGame() {
        google.script.run.withSuccessHandler(displayLastGame).loadLastGame();
      }

      function displayLastGame(gameName) {
        document.getElementById("currentGameTypeBtn").textContent = gameName;
      }

      function toggleGameTypeOptions() {
        const gameOptions = document.getElementById("gameOptionsContainer");
        if (gameOptions.style.display === "none") {
          gameOptions.style.display = "block";
          showGameOptions();
        } else {
          gameOptions.style.display = "none";
        }
      }

      function hideGameTypeOptions() {
        document.getElementById("gameOptionsContainer").style.display = "none";
      }

      function loadGameTypeOptions() {
        google.script.run.withSuccessHandler(function(gameList) {
        const gameTypeOptions = document.getElementById("gameTypeOptions");
        gameList.forEach(function(gameName) {
          const gameOption = document.createElement("div");
          gameOption.classList.add("game-type-option");
          gameOption.textContent = gameName;
          gameOption.onclick = function() {
            setGameType(gameName);
          };
          gameTypeOptions.appendChild(gameOption);
        });
      }).getGameList();

    // Add click event listeners to the buttons
      document.getElementById("newGameBtn").addEventListener("click", newGame);
      document.getElementById("loadGameBtn").addEventListener("click", loadGame);
      document.getElementById("splitTimelineBtn").addEventListener("click", splitTimeline);

      function newGame() {
        // Call the menuNewGame function from the server-side script
        google.script.run.menuNewGame();
      }

      function loadGame() {
        // Prompt the user to select a game to load
        google.script.run.withSuccessHandler(promptLoadGame).getGameList();
      }

      function promptLoadGame(gameList) {
        var gameName = prompt("Please enter the name of the game you want to load:", "");
        if (gameName !== null && gameName !== "") {
          if (gameList.includes(gameName)) {
            google.script.run.loadGameByName(gameName);
          } else {
            alert("Game not found! Please enter a valid game name.");
            loadGame();
          }
        }
      }

      // Add code to display the game state in the UI
        function displayGameState(gameState) {
          var gameStateDisplay = document.getElementById("gameStateDisplay");
          gameStateDisplay.textContent = JSON.stringify(gameState, null, 2);
          
          var sceneDisplay = document.getElementById("sceneDisplay");
          sceneDisplay.textContent = gameState.game.scene;
          
          var imageDisplay = document.getElementById("imageDisplay");
          imageDisplay.innerHTML = "<img src='" + gameState.game.image[0] + "'>";
        }

        // Call the displayGameState function with the game state when the dialog is loaded
        document.addEventListener("DOMContentLoaded", function () {
          google.script.run.withSuccessHandler(displayGameState).getGameState();
        });

        // Add event listener for the submit response button
        document.getElementById("submitResponseBtn").addEventListener("click", submitResponse);

        function submitResponse() {
          var responseInput = document.getElementById("responseInput");
          var response = responseInput.value;
          google.script.run.submitResponse(response);
          responseInput.value = "";
        }

    </script>
  </body>
</html>

