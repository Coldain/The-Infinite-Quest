<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      /* Add any custom styles for your dialog here */
    </style>
  </head>
  <body>
    <h1>Text RPG</h1>
    <div id="gameOptions">
      <h2>Game Type</h2>
      <select id="gameTypeSelect" onchange="showNarratorInfo()">
        <!-- Options will be added dynamically -->
      </select>
      <div id="narratorInfo"></div>
      <!-- ... -->
    </div>
    <button id="newGameBtn">New Game</button>
    <button id="loadGameBtn">Load Game</button>
    <button id="splitTimelineBtn">Split Timeline</button>

    <div id="gameWindow">
      <!-- Add a container for the game window where the game content will be displayed -->
    </div>
    <script>
      // Add JavaScript functions to handle button clicks and other interactions
      function applyGameOptions() {
        var gameType = document.querySelector('input[name="gameType"]:checked').value;
        google.script.run.setGameType(gameType);
      }

      function loadGameOptions() {
        google.script.run.withSuccessHandler(populateGameTypeOptions).getPersonas();
      }

      function populateGameTypeOptions(personas) {
        var select = document.getElementById("gameTypeSelect");
        personas.forEach(function (persona, index) {
          var option = document.createElement("option");
          option.value = index;
          option.textContent = persona.name;
          select.appendChild(option);
        });
        showNarratorInfo();
      }

      // Call loadGameOptions when the dialog is loaded
      document.addEventListener("DOMContentLoaded", loadGameOptions);

      function showNarratorInfo() {
          var select = document.getElementById("gameTypeSelect");
          var selectedIndex = select.value;
          google.script.run.withSuccessHandler(function (personas) {
            var narratorInfo = document.getElementById("narratorInfo");
            narratorInfo.textContent = personas[selectedIndex].narrator;
          }).getPersonas();
        }

        // Add event listeners for hover and focus events
        document.getElementById("gameTypeSelect").addEventListener("mouseover", function (event) {
          if (event.target.tagName === "OPTION") {
            event.target.parentNode.value = event.target.value;
            showNarratorInfo();
          }
        });

        document.getElementById("gameTypeSelect").addEventListener("mouseout", function (event) {
          if (event.target.tagName === "OPTION") {
            showNarratorInfo();
          }
        });

        // Add click event listeners to the buttons
        document.getElementById("newGameBtn").addEventListener("click", newGame);
        document.getElementById("loadGameBtn").addEventListener("click", loadGame);
        document.getElementById("splitTimelineBtn").addEventListener("click", splitTimeline);

        function newGame() {
          // Call the menuNewGame function from the server-side script
          google.script.run.menuNewGame();
        }

        function loadGame() {
          // Prompt the user to select a game to load
          google.script.run.withSuccessHandler(promptLoadGame).getGameList();
        }

        function promptLoadGame(gameList) {
          var gameName = prompt("Please enter the name of the game you want to load:", "");
          if (gameName !== null && gameName !== "") {
            if (gameList.includes(gameName)) {
              google.script.run.loadGameByName(gameName);
            } else {
              alert("Game not found! Please enter a valid game name.");
              loadGame();
            }
          }
        }

        function splitTimeline() {
          // Call the splitTimeline function from the server-side script (you'll need to implement this)
          google.script.run.splitTimeline();
        }

    </script>
  </body>
</html>
